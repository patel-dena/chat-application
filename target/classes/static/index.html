<!DOCTYPE html>
<html>
<head>
    <title>Chat App</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>Real-Time Chat App</h2>
<input type="text" id="username" placeholder="Username"><br><br>
<input type="text" id="receiver" placeholder="Receiver Name (optional)"><br><br>
<input type="text" id="msg" placeholder="Type message">
<button onclick="sendMessage()">Send</button>
<ul id="messages"></ul>

<script>
    let socket = new SockJS('/ws');
    let stompClient = Stomp.over(socket);

    stompClient.connect({}, function () {
        stompClient.subscribe('/topic/public', function (message) {
            let msg = JSON.parse(message.body);
            document.getElementById('messages').innerHTML +=
                `<li>[${msg.timestamp}] ${msg.sender} -> ${msg.receiver || 'All'}: ${msg.content}</li>`;
        });
    });

    function sendMessage() {
        let sender = document.getElementById('username').value || 'User';
        let receiver = document.getElementById('receiver').value; // optional
        let content = document.getElementById('msg').value;

        stompClient.send("/app/chat.sendMessage", {},
            JSON.stringify({sender: sender, receiver: receiver, content: content}));

        document.getElementById('msg').value = '';
    }
</script>
</body>
</html>
